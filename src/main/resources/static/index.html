<!DOCTYPE html>
<html>

<head>
    <title>Dean's Basic CRUD Demo Application</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous">
    </script>
    <script src="service.js"></script>
    <script>
        function checkAppStatus() {
            fetch('/health-check')
                .then(response => {
                    if (response.status === 200) {
                        // App is up! Display the main section and hide the loading section
                        document.getElementById('loadingSection').style.display = 'none';
                        document.getElementById('mainAppSection').style.display = 'block';
                    } else {
                        // App is not ready yet. Wait and try again.
                        setTimeout(checkAppStatus, 5000); // Check every 5 seconds
                    }
                })
                .catch(error => {
                    // Error occurred, possibly the app is not up yet. Wait and try again.
                    setTimeout(checkAppStatus, 5000); // Check every 5 seconds
                });
        }

        // Start the polling as soon as the page loads
        window.onload = checkAppStatus;
    </script>
</head>

<body>

<!-- Loading Section -->
<div id="loadingSection" style="text-align: center; padding-top: 50px;">
    <!-- Display the loading gif -->
    <img src="loading.gif" alt="Loading...">
    <p>Please wait a moment while the app is spun up...</p>
</div>

<!-- Main App Section -->
<div id="mainAppSection" style="display: none;">
    <div class="header">
        <h1>DEAN'S BIG BOY CRUD APP</h1>
    </div>
    <div class="form-container">
        <form>
            <input id="person-id" onclick="highlightAll(event)" placeholder="ID" autocomplete="off"><br>
            <input id="first-name" placeholder="First Name" autocomplete="off"><br>
            <input id="last-name" placeholder="Last Name" autocomplete="off"><br>
            <input id="birth-date" placeholder="Birthdate YYYY-MM-DD" autocomplete="off"><br>
            <button onClick="create(event)">Create</button>
            <button onClick="readById(event)">Read</button>
            <button onClick="readAll(event)">Read All</button>
            <button onClick="update(event)">Update</button>
            <button onClick="deleteThing(event)">Delete</button>
        </form>
        <!-- textarea to display json data instead of using popup -->
        <textarea id="json-display" rows="20" readonly></textarea>
    </div>
</div>

</body>
</html>
